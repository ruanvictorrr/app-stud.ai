{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/ruangalvao/ProjetosVS/Projetos%20Pessoais/stud.ai-app/app-stud.ai/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma?: PrismaClient;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"error\", \"warn\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6HAAA,CAAA,eAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAO;AACxB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///Users/ruangalvao/ProjetosVS/Projetos%20Pessoais/stud.ai-app/app-stud.ai/src/lib/auth.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\nimport { randomBytes } from \"crypto\";\nimport bcrypt from \"bcryptjs\";\nimport { prisma } from \"@/lib/prisma\";\n\nconst SESSION_COOKIE = \"studai_session\";\nconst SESSION_DAYS = 30;\n\nfunction parseAdminEmails(): string[] {\n  const raw = process.env.ADMIN_EMAILS || \"\";\n  return raw\n    .split(\",\")\n    .map((s) => s.trim().toLowerCase())\n    .filter(Boolean);\n}\n\nexport function isAdminEmail(email: string): boolean {\n  const admins = parseAdminEmails();\n  return admins.includes(email.toLowerCase());\n}\n\nexport async function hashPassword(plain: string) {\n  const saltRounds = 12;\n  return bcrypt.hash(plain, saltRounds);\n}\n\nexport async function verifyPassword(plain: string, hash: string) {\n  return bcrypt.compare(plain, hash);\n}\n\nexport function makeSessionToken() {\n  return randomBytes(32).toString(\"hex\");\n}\n\nexport function sessionExpiryDate() {\n  const d = new Date();\n  d.setDate(d.getDate() + SESSION_DAYS);\n  return d;\n}\n\nexport async function createSession(userId: string) {\n  const sessionToken = makeSessionToken();\n  const expires = sessionExpiryDate();\n\n  await prisma.session.create({\n    data: {\n      userId,\n      sessionToken,\n      expires,\n    },\n  });\n\n  // seta cookie (httpOnly)\n  const cookieStore = await cookies();\n  cookieStore.set(SESSION_COOKIE, sessionToken, {\n    httpOnly: true,\n    sameSite: \"lax\",\n    secure: process.env.NODE_ENV === \"production\",\n    path: \"/\",\n    expires,\n  });\n\n  return { sessionToken, expires };\n}\n\nexport async function destroySession() {\n  const cookieStore = await cookies();\n  const token = cookieStore.get(SESSION_COOKIE)?.value;\n\n  if (token) {\n    await prisma.session.deleteMany({ where: { sessionToken: token } });\n  }\n\n  cookieStore.set(SESSION_COOKIE, \"\", {\n    httpOnly: true,\n    sameSite: \"lax\",\n    secure: process.env.NODE_ENV === \"production\",\n    path: \"/\",\n    expires: new Date(0),\n  });\n}\n\nexport async function getCurrentUser() {\n  const cookieStore = await cookies();\n  const token = cookieStore.get(SESSION_COOKIE)?.value;\n  if (!token) return null;\n\n  const session = await prisma.session.findUnique({\n    where: { sessionToken: token },\n    include: { user: true },\n  });\n\n  if (!session) return null;\n\n  // Expirada\n  if (session.expires.getTime() < Date.now()) {\n    await prisma.session.deleteMany({ where: { sessionToken: token } });\n    return null;\n  }\n\n  // Se email estiver na lista ADMIN_EMAILS, garante role ADMIN\n  const user = session.user;\n  if (user.email && isAdminEmail(user.email) && user.role !== \"ADMIN\") {\n    await prisma.user.update({\n      where: { id: user.id },\n      data: { role: \"ADMIN\" },\n    });\n    user.role = \"ADMIN\";\n  }\n\n  return user;\n}\n\nexport async function requireUser() {\n  const user = await getCurrentUser();\n  if (!user) throw new Error(\"UNAUTHORIZED\");\n  return user;\n}\n\nexport async function requireAdmin() {\n  const user = await requireUser();\n  if (user.role !== \"ADMIN\") throw new Error(\"FORBIDDEN\");\n  return user;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 237, "column": 0}, "map": {"version":3,"sources":["file:///Users/ruangalvao/ProjetosVS/Projetos%20Pessoais/stud.ai-app/app-stud.ai/src/app/api/auth/me/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { getCurrentUser } from \"@/lib/auth\";\n\nexport const runtime = \"nodejs\";\n\nexport async function GET() {\n  const user = await getCurrentUser();\n  return NextResponse.json({\n    success: true,\n    user: user\n      ? { id: user.id, name: user.name, email: user.email, role: user.role }\n      : null,\n  });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,MAAM,UAAU;AAEhB,eAAe;IACpB,MAAM,OAAO,MAAM,CAAA,GAAA,oHAAA,CAAA,iBAAc,AAAD;IAChC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QACvB,SAAS;QACT,MAAM,OACF;YAAE,IAAI,KAAK,EAAE;YAAE,MAAM,KAAK,IAAI;YAAE,OAAO,KAAK,KAAK;YAAE,MAAM,KAAK,IAAI;QAAC,IACnE;IACN;AACF","debugId":null}}]
}